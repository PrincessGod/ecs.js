!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.ECS={})}(this,function(e){"use strict";var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],a=function(){function e(){r(this,e)}return t(e,null,[{key:"create",value:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return i[255&e]+i[e>>8&255]+i[e>>16&255]+i[e>>24&255]+"-"+i[255&t]+i[t>>8&255]+"-"+i[t>>16&15|64]+i[t>>24&255]+"-"+i[63&n|128]+i[n>>8&255]+"-"+i[n>>16&255]+i[n>>24&255]+i[255&r]+i[r>>8&255]+i[r>>16&255]+i[r>>24&255]}},{key:"hash",value:function(e){var t=0,n=void 0;if(0===e.length)return t;for(n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}}]),e}(),u=function(){function c(){r(this,c)}return t(c,null,[{key:"getInjectedComponents",value:function(){return c._injected||(c._injected=new Map),c._injected}},{key:"inject",value:function(e){if("function"!=typeof e)return console.error("component not type of function");var t=c.getInjectedComponents(),n=a.hash(e.name);return t.has(n)?console.warn("component "+e+" has already injected"):(Object.defineProperties(e.prototype,{uuid:{get:function(){return this._uuid}},componentKey:{get:function(){return n}}}),t.set(n,e)),n}},{key:"create",value:function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("function"==typeof e){var i=new(Function.prototype.bind.apply(e,[null].concat(n)));return i._uuid=a.create(),i}if("number"==typeof e){var o=c.getInjectedComponents();if(o.has(e)){var u=o.get(e),s=new(Function.prototype.bind.apply(u,[null].concat(n)));return s._uuid=a.create(),s}}return console.error("unknown component info: "+e)}}]),c}(),n=function(){function e(){r(this,e),this._uuid=a.create(),this._com={}}return t(e,[{key:"addComponent",value:function(e){var t=void 0;if("number"==typeof e)t=u.getInjectedComponents().get(e).name;else{if("function"!=typeof e)return e.componentKey?(t=e.constructor.name,this._com[t]=e,this._com[t]):console.error("wrong argument type");t=e.name}if(this._com[t])console.warn("componnet type "+t+" existed");else{for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=u.create.apply(u,[e].concat(r));this._com[t]=o}return this._com[t]}},{key:"removeComponent",value:function(e){var t=void 0;if("number"==typeof e)t=u.getInjectedComponents().get(e).name;else if("function"==typeof e)t=e.name;else{if(!e.componentKey)return console.error("argument type error");t=e.constructor.name}var n=this._com[t];return delete this._com[t],n}},{key:"getComponent",value:function(e){var t=void 0;if("number"==typeof e)t=u.getInjectedComponents().get(e).name;else{if("function"!=typeof e)return e.componentKey?(t=e.constructor.name,this._com[t]):console.error("argument type error");t=e.name}return this._com[t]}},{key:"uuid",get:function(){return this._uuid}},{key:"com",get:function(){return this._com}}]),e}(),o=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";if(r(this,n),!e)throw Error("searchString not passed");this._searchString=n.getSearchString(e);var t=this._searchString.split("&");this._requiredComs=t.filter(function(e){return"!"!==e[0]}),this._disabledComs=t.filter(function(e){return"!"===e[0]}).map(function(e){return e.slice(1)}),this._entities=[]}return t(n,[{key:"addEntity",value:function(e){return!!(this.test(e)&&this._entities.indexOf(e)<0)&&(this._entities.push(e),!0)}},{key:"removeEntity",value:function(e){var t=this._entities.indexOf(e);return-1<t&&this._entities.splice(t,1)[0]}},{key:"test",value:function(t){return!this._requiredComs.filter(function(e){return!t.com[e]}).length&&!this._disabledComs.filter(function(e){return t.com[e]}).length}},{key:"searchString",get:function(){return this._searchString}},{key:"entities",get:function(){return this._entities}}],[{key:"getSearchString",value:function(e){return"string"==typeof e&&e?e.replace(/\s/g,"").split("&").sort().join("&"):console.error("unvalued search string "+e)}}]),n}(),s=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];r(this,n),this._priority=e,this._enable=t}return t(n,[{key:"update",value:function(e){}},{key:"priority",get:function(){return this._priority}},{key:"enable",get:function(){return this._enable}}]),n}(),c=function(){function e(){r(this,e),this._entitys=[],this._groups=new Map,this._systems=[]}return t(e,[{key:"addEntity",value:function(t){return this._entitys.indexOf(t)<0?(this._entitys.push(t),this._groups.forEach(function(e){return e.addEntity(t)})):console.warn("entity "+t+" already existed"),this}},{key:"removeEntity",value:function(t){var e=this._entitys.indexOf(t);return-1<e&&(this._entitys.splice(e,1),this._groups.forEach(function(e){return e.removeEntity(t)})),this}},{key:"getGroup",value:function(e){var t=o.getSearchString(e);if(this._groups.has(t))return this._groups.get(t);var n=new o(t);return this._entitys.forEach(function(e){return n.addEntity(e)}),this._groups.set(t,n),n}},{key:"addSystem",value:function(e){return e instanceof s&&(this._systems.push(e),this._systems.sort(function(e,t){return e.priority-t.priority})),this}},{key:"removeSystem",value:function(e){for(;-1<this._systems.indexOf(e);){var t=this._systems.indexOf(e);this._systems.splice(t,1)}return this}},{key:"execute",value:function(){var t=this;return this._systems.forEach(function(e){return e.enable&&e.update(t)}),this}},{key:"entitys",get:function(){return this._entitys}},{key:"entityCount",get:function(){return this._entitys.length}},{key:"systems",get:function(){return this._systems}}]),e}();e.UUID=a,e.Component=u,e.Entity=n,e.Context=c,e.Group=o,e.System=s,Object.defineProperty(e,"__esModule",{value:!0})});
